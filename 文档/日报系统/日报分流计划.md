# 日报接口分流计划

## 完成状态
✅ 已完成分流

采用方案二（按权限分流），将原 `/jiekou/xitong/ribao` 拆分为两个独立接口：

### 新接口结构
| 接口路径 | 功能 | 操作数 |
|---------|------|-------|
| `/jiekou/ribao/yonghu` | 普通用户操作 | 4 |
| `/jiekou/ribao/guanli` | 管理员操作（全部） | 35 |

### 文件变更
- 后端：
  - 新建 `src/jiekouxt/jiekou_nr/ribao/jiekou_ribao_yonghu.rs` - 普通用户接口
  - 新建 `src/jiekouxt/jiekou_nr/ribao/jiekou_ribao.rs` - 管理员接口（从 xitong 移动）
  - 新建 `src/jiekouxt/jiekou_nr/ribao/mod.rs` - 模块注册
  - 删除 `src/jiekouxt/jiekou_nr/xitong/jiekou_ribao.rs`
- WASM SDK：
  - 新建 `wasm_sdk/src/jiekou_nr/ribao/ribaoyonghu.rs` - 普通用户请求
  - 新建 `wasm_sdk/src/jiekou_nr/ribao/ribaoguanli.rs` - 管理员请求
  - 新建 `wasm_sdk/src/jiekou_nr/ribao/mod.rs`
  - `wasm_sdk/src/lib.rs` 添加 `ribaoyonghuqingqiu` 方法
- 前端：
  - `wasm_sdk/ribao_luoji.js` 添加 `yonghuzhixing` 方法，普通用户操作自动路由到用户接口

## 现有功能清单

### 1. 标签类型管理（6个操作）
| 操作名称 | 功能描述 | 参数 |
|---------|---------|------|
| `leixing_xinzeng` | 新增标签类型 | mingcheng |
| `leixing_shanchu` | 删除标签类型 | id |
| `leixing_gengxin` | 更新标签类型 | id, mingcheng |
| `leixing_chaxun_id` | 按ID查询标签类型 | id |
| `leixing_chaxun_mingcheng` | 按名称查询标签类型 | mingcheng |
| `leixing_chaxun_quanbu` | 查询所有标签类型 | 无 |

### 2. 标签管理（7个操作）
| 操作名称 | 功能描述 | 参数 |
|---------|---------|------|
| `biaoqian_xinzeng` | 新增标签 | leixingid, zhi |
| `biaoqian_shanchu` | 删除标签 | id |
| `biaoqian_gengxin` | 更新标签 | id, zhi |
| `biaoqian_chaxun_id` | 按ID查询标签 | id |
| `biaoqian_chaxun_leixingid` | 按类型ID查询标签列表 | leixingid |
| `biaoqian_chaxun_leixingid_zhi` | 按类型ID和值查询标签 | leixingid, zhi |
| `biaoqian_chaxun_quanbu` | 查询所有标签 | 无 |
| `biaoqian_chaxun_leixing` | 查询标签所属类型 | biaoqianid |

### 3. 日报管理（10个操作）
| 操作名称 | 功能描述 | 参数 | 权限 |
|---------|---------|------|------|
| `ribao_xinzeng` | 新增日报 | yonghuid, neirong, fabushijian | 普通用户可用 |
| `ribao_shanchu` | 删除日报 | id | 管理员 |
| `ribao_gengxin` | 更新日报 | id, ziduanlie | 管理员 |
| `ribao_chaxun_id` | 按ID查询日报 | id | 管理员 |
| `ribao_chaxun_yonghuid` | 按用户ID查询日报 | yonghuid | 普通用户可用（自动填充自己的ID） |
| `ribao_chaxun_quanbu` | 查询所有日报 | 无 | 管理员 |
| `ribao_chaxun_fenye` | 分页查询日报 | yeshu, meiyetiaoshu | 管理员 |
| `ribao_chaxun_yonghuid_fenye` | 按用户ID分页查询 | yonghuid, yeshu, meiyetiaoshu | 普通用户可用 |
| `ribao_tongji_zongshu` | 统计日报总数 | 无 | 管理员 |
| `ribao_tongji_yonghuid_zongshu` | 统计用户日报总数 | yonghuid | 普通用户可用 |
| `ribao_chaxun_guanjianci_fenye` | 关键词分页搜索 | guanjianci, yeshu, meiyetiaoshu | 管理员 |

### 4. 日报-标签关联管理（8个操作）
| 操作名称 | 功能描述 | 参数 |
|---------|---------|------|
| `guanlian_xinzeng` | 新增关联 | ribaoid, biaoqianid |
| `guanlian_shanchu_ribaoid` | 删除日报的所有关联 | ribaoid |
| `guanlian_shanchu` | 删除单条关联 | ribaoid, biaoqianid |
| `guanlian_chaxun_ribaoid` | 查询日报的关联 | ribaoid |
| `guanlian_chaxun_biaoqianid` | 查询标签的关联 | biaoqianid |
| `guanlian_chaxun_leixingmingcheng_zhi` | 按类型名称和值查询关联 | leixingmingcheng, zhi |
| `guanlian_chaxun_ribaoid_daixinxi` | 查询日报关联（带详情） | ribaoid |
| `guanlian_chaxun_xiangguanbiaoqian` | 查询相关标签 | biaoqianid, leixingmingcheng |
| `guanlian_piliang_xinzeng` | 批量新增关联 | ribaoid, biaoqianidlie |

### 5. AI处理（1个操作）
| 操作名称 | 功能描述 | 参数 |
|---------|---------|------|
| `renwu_biaoqian_ai_chuli` | AI标签处理任务 | shuliang（可选） |

## 统计
- **标签类型管理**：6 个操作
- **标签管理**：8 个操作
- **日报管理**：11 个操作
- **关联管理**：9 个操作
- **AI处理**：1 个操作
- **总计**：35 个操作

## 权限说明

### 普通用户接口 `/jiekou/ribao/yonghu`
支持 4 个操作，`yonghuid` 自动从 JWT 注入：
- `xinzeng` - 新增日报
- `chaxun` - 查询自己的日报
- `chaxun_fenye` - 分页查询自己的日报
- `tongji_zongshu` - 统计自己的日报总数

### 管理员接口 `/jiekou/ribao/guanli`
需要接口权限校验（路径 `/jiekou/ribao/guanli`），包含全部 35 个操作。

## 原分流建议（已采用方案二）

### 方案一：按实体分流
将现有接口拆分为 4 个独立接口（未采用）

### 方案二：按权限分流 ✅ 已采用
| 新接口路径 | 功能 | 说明 |
|-----------|------|------|
| `/jiekou/ribao/yonghu` | 普通用户操作 | 仅包含普通用户可执行的操作 |
| `/jiekou/ribao/guanli` | 管理员操作 | 管理员专用操作 |

### 方案三：混合分流
保留核心日报操作在主接口，将标签相关操作分离（未采用）
