# 日报系统数据库设计

## 日报表 (shujubiao_ribao)

存储用户发送的日报内容和时间信息。

| 字段名 | 昵称 | 说明 | 类型 | 默认值 |
|---|---|---|---|---|
| `id` | 日报ID | 日报唯一标识 | `BIGSERIAL PRIMARY KEY` | 无 |
| `yonghuid` | 用户ID | 发送日报的用户ID | `BIGINT NOT NULL` | 无 |
| `neirong` | 日报内容 | 日报的具体内容 | `TEXT NOT NULL` | 无 |
| `fabushijian` | 发布时间 | 日报发布的时间戳 | `TEXT NOT NULL` | 无 |
| `chuangjianshijian` | 创建时间 | 记录创建时间 | `TEXT NOT NULL` | 无 |
| `gengxinshijian` | 更新时间 | 记录最后更新时间 | `TEXT NOT NULL` | 无 |

## 标签类型表 (shujubiao_biaoqianleixing)

定义标签的分类类型，如"地名"、"项目名"等。

| 字段名 | 昵称 | 说明 | 类型 | 默认值 |
|---|---|---|---|---|
| `id` | 类型ID | 标签类型唯一标识 | `BIGSERIAL PRIMARY KEY` | 无 |
| `mingcheng` | 类型名称 | 标签类型的名称，如"地名" | `TEXT NOT NULL UNIQUE` | 无 |
| `chuangjianshijian` | 创建时间 | 记录创建时间 | `TEXT NOT NULL` | 无 |
| `gengxinshijian` | 更新时间 | 记录最后更新时间 | `TEXT NOT NULL` | 无 |

## 标签表 (shujubiao_biaoqian)

存储具体的标签值，归属于某个标签类型。

| 字段名 | 昵称 | 说明 | 类型 | 默认值 |
|---|---|---|---|---|
| `id` | 标签ID | 标签唯一标识 | `BIGSERIAL PRIMARY KEY` | 无 |
| `leixingid` | 类型ID | 所属的标签类型ID | `BIGINT NOT NULL` | 无 |
| `zhi` | 标签值 | 标签的具体值，如"广东"、"青岛" | `TEXT NOT NULL` | 无 |
| `chuangjianshijian` | 创建时间 | 记录创建时间 | `TEXT NOT NULL` | 无 |
| `gengxinshijian` | 更新时间 | 记录最后更新时间 | `TEXT NOT NULL` | 无 |

**约束：** `UNIQUE(leixingid, zhi)` - 同一类型下标签值唯一

## 日报标签关联表 (shujubiao_ribao_biaoqian)

建立日报与标签的多对多关联关系。

| 字段名 | 昵称 | 说明 | 类型 | 默认值 |
|---|---|---|---|---|
| `ribaoid` | 日报ID | 关联的日报ID | `BIGINT NOT NULL` | 无 |
| `biaoqianid` | 标签ID | 关联的标签ID | `BIGINT NOT NULL` | 无 |
| `chuangjianshijian` | 创建时间 | 记录创建时间 | `TEXT NOT NULL` | 无 |

**主键：** `PRIMARY KEY (ribaoid, biaoqianid)`

## 关联关系

```
用户表 (1) ──── (N) 日报表
  id       <────  yonghuid

标签类型表 (1) ──── (N) 标签表
  id         <────  leixingid

日报表 (N) ──── (N) 标签表
  id    <────┐         ┌────>  id
            └─ 关联表 ─┘
         ribaoid  biaoqianid
```

- 一个用户可以发送多条日报（一对多）
- 一个标签类型下可以有多个标签值（一对多）
- 一条日报可以有多个标签，一个标签可以关联多条日报（多对多）

## 使用场景

### 查询某个标签类型下的所有标签
```sql
SELECT b.* FROM shujubiao_biaoqian b
JOIN shujubiao_biaoqianleixing l ON b.leixingid = l.id
WHERE l.mingcheng = '地名';
```

### 查询包含某个标签的所有日报
```sql
SELECT r.* FROM shujubiao_ribao r
JOIN shujubiao_ribao_biaoqian rb ON r.id = rb.ribaoid
JOIN shujubiao_biaoqian b ON rb.biaoqianid = b.id
WHERE b.zhi = '广东';
```

### 查询某条日报的所有标签
```sql
SELECT b.*, l.mingcheng as leixing FROM shujubiao_biaoqian b
JOIN shujubiao_biaoqianleixing l ON b.leixingid = l.id
JOIN shujubiao_ribao_biaoqian rb ON b.id = rb.biaoqianid
WHERE rb.ribaoid = 1;
```
